<h1>Users</h1>
<div class="create-button">
    <p-button label="Create" severity="success" (onClick)="createUserModal = true" />
</div>
<div class="main">
    <p-table [value]="allUsers" [tableStyle]="{ 'min-width': '50rem' }">
        <ng-template pTemplate="header">
            <tr>
                <th class="center">Name</th>
                <th class="center">Email</th>
                <th class="center">Date Of Birth</th>
                <th class="center">Active</th>
                <th class="center">Available</th>
                <th class="center">Tasks</th>
                <th style="text-align: center;">Actions</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-user>
            <tr>
                <td class="center"><strong>{{ user.name }}</strong></td>
                <td class="center">{{ user.email }}</td>
                <td class="center">{{ user.dateOfBirth | date: 'dd/MM/yyyy'}}</td>
                <td class="center">{{ user.active }}</td>
                <td class="center">{{ user.available }}</td>
                <td class="center">{{ user.tasks.length }}</td>
                <td style="text-align: center;"><p-button label="edit" (onClick)="openEditModal(user)"/> <p-button label="delete" severity="danger" (onClick)="openDeleteUserModal(user)" /></td>
            </tr>
        </ng-template>
    </p-table>
</div>

<h1>Tasks</h1>
<div class="create-button">
    <p-button label="Create" severity="success" (onClick)="createTaskModal = true" />
</div>
<div class="main">
    <p-table [value]="allTasks" [tableStyle]="{ 'min-width': '50rem' }">
        <ng-template pTemplate="header">
            <tr>
                <th class="center">Title</th>
                <th class="center">Description</th>
                <th class="center">Created</th>
                <th class="center">Active</th>
                <th class="center">Status</th>
                <th class="center">User</th>
                <th style="text-align: center;">Actions</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-task>
            <tr>
                <td class="center"><strong>{{ task.title }}</strong></td>
                <td class="center">{{ task.description }}</td>
                <td class="center">{{ task.created | date: 'dd/MM/yyyy'}}</td>
                <td class="center">{{ task.active }}</td>
                <td class="center">{{ task.taskStatus }}</td>
                <td class="center">{{ task.user.name }}</td>
                <td style="text-align: center;"><p-button label="edit" (onClick)="openEditTaskModal(task)"/> <p-button label="delete" severity="danger" (onClick)="openDeleteTaskModal(task)" /></td>
            </tr>
        </ng-template>
    </p-table>
</div>

<app-loading *ngIf="loading"></app-loading>

<!-- modal user -->

<p-dialog header="Edit a User" [modal]="true" [(visible)]="userModal" [style]="{ width: '25rem' }">
    
</p-dialog>

<!-- task user -->

<p-dialog header="Edit a Task" [modal]="true" [(visible)]="taskModal" [style]="{ width: '25rem' }">
    
</p-dialog>

<!-- delete user modal -->

<p-dialog header="Delete a User" [modal]="true" [(visible)]="deleteUserModal" [style]="{ width: '25rem' }">
    <span class="p-text-secondary block mb-5">Are you sure you want to delete this user?</span>
    
    <div class="flex justify-content-end gap-2" style="margin-top: 10px;">
        <p-button label="Cancel" severity="secondary" (onClick)="deleteUserModal = false" />
        <p-button label="Delete" severity="danger" (onClick)="deleteUser()" />
    </div>
</p-dialog>

<!-- delete task modal -->

<p-dialog header="Delete a Task" [modal]="true" [(visible)]="deleteTaskModal" [style]="{ width: '25rem' }">
    <span class="p-text-secondary block mb-5" >Are you sure you want to delete this task?</span>
    
    <div class="flex justify-content-end gap-2" style="margin-top: 10px;">
        <p-button label="Cancel" severity="secondary" (onClick)="deleteTaskModal = false" />
        <p-button label="Delete" severity="danger" (onClick)="deleteTask()" />
    </div>
</p-dialog>

<!-- create user modal -->

<p-dialog header="Create a User" [modal]="true" [(visible)]="createUserModal" [style]="{ width: '25rem' }">

    <div class="flex flex-column gap-2 form">
        <label for="username">Name</label>
        <input 
            style="margin-left: 10px;"
            pInputText 
            id="username" 
            aria-describedby="username-help" 
            [(ngModel)]="UserName" />
    </div>

    <div class="flex flex-column gap-2 form">
        <label for="username">E-mail</label>
        <input 
            style="margin-left: 10px;"
            pInputText 
            id="username" 
            aria-describedby="email-help" 
            [(ngModel)]="UserEmail" />
            <br>
            <small id="username-help" style="color: red;">
                must have "<span>&#64;</span>" and ".com" to be a valid e-mail.
            </small>
    </div>
    <div class="form">
        <label for="">Date of Birth</label>
        <p-calendar 
        [(ngModel)]="UserDateOfBirth" 
        [touchUI]="true" 
        [readonlyInput]="true" />
    </div>

    <div class="create-button">
        <p-button label="Create" severity="success" (onClick)="createUser()" />
    </div>
    
</p-dialog>

<!-- create task modal -->

<p-dialog header="Create a Task" [modal]="true" [(visible)]="createTaskModal" [style]="{ width: '25rem' }">

    <div class="form">
        <label>User</label>
        <p-dropdown
        [options]="allUsers"
        [(ngModel)]="TaskSelectedUser"
        optionLabel="name"
        placeholder="Select a User" />
    </div>

    <div class="form">
        <label>Task Status</label>
        <p-dropdown
        [options]="AllTaskStatus"
        [(ngModel)]="TaskSelectedStatus"
        placeholder="Select a Status" />
    </div>

    <div class="flex flex-column gap-2 form">
        <label for="username">Title</label>
        <input 
            style="margin-left: 10px;"
            pInputText 
            [(ngModel)]="TaskTitle" />
    </div>

    <div class="flex flex-column gap-2 form">
        <label for="username">Description</label>
        <input 
            style="margin-left: 10px;"
            pInputText 
            [(ngModel)]="TaskDescription" />
            <br>
    </div>
    

    <div class="create-button">
        <p-button label="Create" severity="success" (onClick)="createTask()" />
    </div>
</p-dialog>